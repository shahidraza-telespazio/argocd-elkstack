eck-kibana:
  spec:
    elasticsearchRef:
      name: elasticsearch
    config:
      server:
        publicBaseUrl: <<PATCH>>
    http:
      tls:
        certificate:
          secretName: kibana-tls

eck-beats:
  enabled: true
  metadata:
    name: filebeat
  spec:
    type: filebeat
    elasticsearchRef:
      name: elasticsearch
    config:
      filebeat.inputs:
        - type: container
          paths:
            - /var/log/containers/*.log
      output.elasticsearch:
        hosts: ["logstash:5044"]
    daemonSet:
      podTemplate:
        spec:
          dnsPolicy: ClusterFirstWithHostNet
          hostNetwork: true
          securityContext:
            runAsUser: 0
          containers:
            - name: filebeat
              volumeMounts:
                - name: varlogcontainers
                  mountPath: /var/log/containers
                - name: varlogpods
                  mountPath: /var/log/pods
                - name: varlibdockercontainers
                  mountPath: /var/lib/docker/containerss
          volumes:
            - name: varlogcontainers
              hostPath:
                path: /var/log/containers
            - name: varlogpods
              hostPath:
                path: /var/log/pods
            - name: varlibdockercontainers
              hostPath:
                path: /var/lib/docker/containers

eck-logstash:
  enabled: true
  config:
    logstash.conf: |
      input {
        beats {
          port => 5044
        }
      }
      output {
        elasticsearch {
          hosts => [ "${ECK_ES_HOSTS}" ]
          user => "${ECK_ES_USER}"
          password => "${ECK_ES_PASSWORD}"
          ssl_certificate_authorities => "${ECK_ES_SSL_CERTIFICATE_AUTHORITY}"
        }
      }
  services:
    - name: beats
      service:
        spec:
          type: ClusterIP
          ports:
            - port: 5044
              name: "filebeat"
              protocol: TCP
              targetPort: 5044
